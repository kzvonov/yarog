<%
  hero_data = hero.hero_data
  stats = hero_data['stats'] || {}
  debilities = hero_data['debilities'] || {}
%>

<div id="hero_card_<%= hero.id %>" class="hero-card" data-controller="collapsible">
  <div class="hero-card-header">
    <h2><%= link_to hero.name, master_hero_path(hero) %></h3>
    <div class="basics text-muted copy-handler" data-copy-value="<%= hero.code %>">
      Spec <span class="text-primary"><%= hero.specialization.titleize %></span> • Lvl <span class="text-primary"><%= hero.level %></span> • Code <span class="text-primary"><%= hero.code %></span>
    </div>
  </div>

  <!-- Main Content -->
  <div class="hero-card-content">
    <div class="hero-card-stats text-muted">
      <div class="stat">HP: <span class="stat-value text-red"><%= hero_data['hpCurrent'] %>/<%= hero_data['hpMax'] %></span></div>
      <div class="stat">ARM: <span class="stat-value text-primary"><%= hero_data['armor'] %></span></div>
      <div class="stat">DMG: <span class="stat-value text-primary"><%= hero_data['damage'] %></span></div>
      <div class="stat">XP: <span class="stat-value text-primary"><%= hero.xp %>/<%= hero.level + 7 %></span></div>
    </div>

    <div class="grid-2 mb-5">
      <table>
        <tbody>
          <% %w[str dex con].each do |stat| %>
            <tr>
              <td><%= stat.upcase %></td>
              <td>
                <%= stats[stat].to_i %> (<%= stat_modifier(stats[stat], debility: debilities[stat].to_s == "true") %>)
                <%= debilities[stat].to_s == "true" ? "⚠️" : "" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <table>
        <tbody>
          <% %w[int wis cha].each do |stat| %>
            <tr>
              <td><%= stat.upcase %></td>
              <td>
                <%= stats[stat].to_i %> (<%= stat_modifier(stats[stat], debility: debilities[stat].to_s == "true") %>)
                <%= debilities[stat].to_s == "true" ? "⚠️" : "" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <!-- Abilities Section (Collapsible, default closed) -->
    <div class="collapsible-section-large">
      <button type="button" class="collapsible-header-large"
              data-action="click->collapsible#toggle"
              data-collapsible-section="abil-<%= hero.id %>">
        <span>▶ Abilities</span>
      </button>
      <div class="collapsible-content-large hidden" data-collapsible-target="content" data-section="abil-<%= hero.id %>">
        <div class="abilities-large">
          <% (hero_data['moves'] || []).each do |move| %>
            <div class="ability-large">
              <div class="ability-large-name"><%= move['name'].strip %></div>
              <div class="ability-large-desc"><%= move['desc'].strip %></div>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Equipment Section (Collapsible, default closed) -->
    <div class="collapsible-section-large">
      <button type="button" class="collapsible-header-large"
              data-action="click->collapsible#toggle"
              data-collapsible-section="equip-<%= hero.id %>">
        <span>▶ Equipment</span>
      </button>
      <div class="collapsible-content-large hidden" data-collapsible-target="content" data-section="equip-<%= hero.id %>">
        <div class="equipment-large"><%= hero_data['weapons'].present? ? hero_data['weapons'].to_s.strip : 'No weapons' %></div>
        <div class="equipment-large"><%= hero_data['equipment'].present? ? hero_data['equipment'].to_s.strip : 'No equipment' %></div>
      </div>
    </div>
  </div>

  <!-- Logs Section (at bottom) -->
  <div class="hero-logs-panel">
    <div class="hero-logs-header">
      Logs (<%= hero.logs.count %>)
    </div>
    <div id="hero_<%= hero.id %>_logs" class="hero-logs-content">
      <% hero.logs.order(created_at: :desc).limit(50).each do |log| %>
        <div class="hero-log-entry">
          <span class="hero-log-time"><%= log.created_at.strftime('%H:%M') %></span>
          <span class="hero-log-message"><%= log.formatted_message.html_safe %></span>
        </div>
      <% end %>
      <% if hero.logs.count == 0 %>
        <div class="hero-logs-empty">No logs yet</div>
      <% end %>
    </div>
  </div>
</div>
