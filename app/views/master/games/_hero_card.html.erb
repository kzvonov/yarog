<%
  hero_data = hero.hero_data
  stats = hero_data['stats'] || {}
  debilities = hero_data['debilities'] || {}

  # Calculate modifiers
  def modifier(stat_value)
    return 0 if stat_value.nil?
    ((stat_value - 10) / 2.0).floor
  end
%>

<div id="hero_card_<%= hero.id %>" class="hero-card-large" data-controller="collapsible">
  <!-- Hero Header -->
  <div class="hero-card-large-header">
    <div class="hero-card-large-name"><%= hero.name %></div>
    <div class="hero-card-large-meta"><%= hero.specialization.titleize %> • Lvl <%= hero.level %> • Code <%= hero.code %></div>
  </div>

  <!-- Main Content -->
  <div class="hero-card-large-content">
    <!-- Basics Section (Always Visible) -->
    <div class="basics-section-large">
      <div class="stats-inline">
        <div class="stat-inline">
          <span class="stat-label-inline">HP:</span>
          <span class="stat-value-inline" style="color: var(--accent-blood-light);"><%= hero_data['hpCurrent'] %>/<%= hero_data['hpMax'] %></span>
        </div>
        <div class="stat-inline">
          <span class="stat-label-inline">Armor:</span>
          <span class="stat-value-inline"><%= hero_data['armor'] %></span>
        </div>
        <div class="stat-inline">
          <span class="stat-label-inline">Damage:</span>
          <span class="stat-value-inline"><%= hero_data['damage'] %></span>
        </div>
        <div class="stat-inline">
          <span class="stat-label-inline">XP:</span>
          <span class="stat-value-inline"><%= hero.xp %></span>
        </div>
        <div class="stat-inline">
          <span class="stat-label-inline">Ver:</span>
          <span class="stat-value-inline"><%= hero.version %></span>
        </div>
      </div>
    </div>

    <!-- Characteristics Section (Collapsible, default closed) -->
    <div class="collapsible-section-large">
      <button type="button" class="collapsible-header-large"
              data-action="click->collapsible#toggle"
              data-collapsible-section="char-<%= hero.id %>">
        <span>▶ Characteristics</span>
      </button>
      <div class="collapsible-content-large hidden" data-collapsible-target="content" data-section="char-<%= hero.id %>">
        <div class="stats-large">
          <% %w[str dex con int wis cha].each do |stat| %>
            <div class="stat-row-large" style="<%= debilities[stat] ? 'border-color: var(--accent-blood); background: rgba(139, 0, 0, 0.1);' : '' %>">
              <span class="stat-label-large"><%= stat.upcase %>:</span>
              <span class="stat-value-large">
                <%= stats[stat] || 10 %> (<%= modifier(stats[stat]) >= 0 ? "+#{modifier(stats[stat])}" : modifier(stats[stat]) %>)
                <%= debilities[stat] ? "⚠️" : "" %>
              </span>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Abilities Section (Collapsible, default closed) -->
    <div class="collapsible-section-large">
      <button type="button" class="collapsible-header-large"
              data-action="click->collapsible#toggle"
              data-collapsible-section="abil-<%= hero.id %>">
        <span>▶ Abilities</span>
      </button>
      <div class="collapsible-content-large hidden" data-collapsible-target="content" data-section="abil-<%= hero.id %>">
        <div class="abilities-large">
          <% (hero_data['moves'] || []).each do |move| %>
            <div class="ability-large">
              <div class="ability-large-name"><%= move['name'].strip %></div>
              <div class="ability-large-desc"><%= move['desc'].strip %></div>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Equipment Section (Collapsible, default closed) -->
    <div class="collapsible-section-large">
      <button type="button" class="collapsible-header-large"
              data-action="click->collapsible#toggle"
              data-collapsible-section="equip-<%= hero.id %>">
        <span>▶ Equipment</span>
      </button>
      <div class="collapsible-content-large hidden" data-collapsible-target="content" data-section="equip-<%= hero.id %>">
        <div class="equipment-large">
          <%= hero_data['equipment'].present? ? hero_data['equipment'].strip : 'No equipment' %>
        </div>
      </div>
    </div>
  </div>

  <!-- Logs Section (at bottom) -->
  <div class="hero-logs-panel">
    <div class="hero-logs-header">
      Logs (<%= hero.logs.count %>)
    </div>
    <div id="hero_<%= hero.id %>_logs" class="hero-logs-content">
      <% hero.logs.order(created_at: :desc).limit(50).each do |log| %>
        <div class="hero-log-entry">
          <span class="hero-log-time"><%= log.created_at.strftime('%H:%M') %></span>
          <span class="hero-log-message"><%= log.formatted_message.html_safe %></span>
        </div>
      <% end %>
      <% if hero.logs.count == 0 %>
        <div class="hero-logs-empty">No logs yet</div>
      <% end %>
    </div>
  </div>
</div>
